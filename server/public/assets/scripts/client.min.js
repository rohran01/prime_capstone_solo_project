var app=angular.module("landingApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/login.html",controller:"LoginController"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/dailyLogs",{templateUrl:"views/dailyLogs.html",controller:"DailyLogsController"}).when("/goals",{templateUrl:"views/goals.html",controller:"GoalsController"}).when("/myFoods",{templateUrl:"views/myFoods.html",controller:"MyFoodsController"}).when("/stats",{templateUrl:"views/stats.html",controller:"StatsController"}),b.html5Mode(!0)}]),app.controller("MainController",["$scope","UserService",function(a,b){a.userInfo=b.userInfo}]),app.controller("RegisterController",["$scope","$http","$location","UserService",function(a,b,c,d){a.newUser={},a.registerUser=function(){b.post("/registerUser",a.newUser).then(function(a){200==a.status&&c.path("login")})}}]),app.controller("LoginController",["$scope","$http","$location","UserService",function(a,b,c,d){console.log("what!?",a.userInfo),a.userLogin={},a.loginUser=function(){b.post("/loginUser",a.userLogin).then(function(a){200==a.status?(d.getUserInfo(),c.path("dailyLogs")):c.path("login")})}}]),app.controller("DailyLogsController",["$scope","$http","UserService",function(a,b,c){function d(){c.getUserInfo().then(function(a){e()})}function e(){var b=c.userInfo.data.logs;a.date=c.userInfo.currentDate.toISOString(),a.date=a.date.substring(0,10);var d=[];a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[];for(var e=0;e<b.length;e++){var f=b[e].date;f=f.substring(0,10),f==a.date&&d.push(b[e])}for(var e=0;e<d.length;e++)"Breakfast"===d[e].meal?a.breakfasts.push(d[e].food):"Lunch"===d[e].meal?a.lunches.push(d[e].food):"Dinner"===d[e].meal?a.dinners.push(d[e].food):"Snacks"===d[e].meal&&a.snacks.push(d[e].food),console.log("snacks for today:",a.snacks)}function f(e){var f={username:c.userInfo.data.username,log:{date:a.date,food:e,meal:a.meal}};b.put("/userInfo/addLog",f).then(function(a){console.log("addLog response:",a),d()})}a.userInfo=c.userInfo,a.date=c.userInfo.currentDate,a.displayDate=c.userInfo.currentDate.toDateString(),a.meal="",a.addWindow=!1,a.searchFoods=[],a.loggedFoods=[],a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[],a.addToMeal=function(b){a.meal=b,a.addWindow=!0,console.log(a.addWindow)},a.searchMyFoods=function(b){a.searchFoods=[];for(var d=c.userInfo.data.myFoods,e=0;e<d.length;e++)d[e].name.toLowerCase()===b.toLowerCase()&&a.searchFoods.push(d[e])},a.addFood=function(a){for(var b=c.userInfo.data.myFoods,d=0;d<b.length;d++)b[d]._id===a&&f(b[d])},a.prevDay=function(){c.prevDay(),d()},a.nextDay=function(){console.log(a.date),c.nextDay(),d(),console.log(c.userInfo.currentDate)},d()}]),app.controller("GoalsController",["$scope","$http","UserService",function(a,b,c){}]),app.controller("MyFoodsController",["$scope","$http","UserService",function(a,b,c){a.myFood={},a.userInfo=c.userInfo,console.log("user info from myFoods",a.userInfo),a.allMyFoods=a.userInfo.data.myFoods,a.addMyFood=function(){a.error="",console.log(a.myFood);var d={username:a.userInfo.data.username,foodToAdd:a.myFood};b.put("/userInfo/addFood",d).then(function(b){console.log("add food response:",b),"error"==b.data&&(a.error="Could not add that food. Please make sure all blanks are filled in.",console.log(a.error)),c.getUserInfo(a.userInfo.data.username),a.displayMyFoods()})},a.displayMyFoods=function(){a.allMyFoods=a.userInfo.data.myFoods,console.log("allMyFoods",a.allMyFoods),c.getUserInfo()},a.displayMyFoods()}]),app.controller("StatsController",["$scope","$http","UserService",function(a,b,c){}]),app.factory("UserService",["$http",function(a){function b(){return console.log("getUserInfo called"),a.get("/userInfo").success(function(a){return console.log(a),e.data=a,e.data.isLoggedIn=!0,a})}function c(){var a=new Date;a.setDate(a.getDate()-1),e.currentDate=a}function d(){var a=new Date;a.setDate(a.getDate()+1),e.currentDate=a,console.log("inside:",e.currentDate)}var e={},f=new Date;return e.currentDate=f,{getUserInfo:b,userInfo:e,prevDay:c,nextDay:d}}]);