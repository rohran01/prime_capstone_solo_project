var app=angular.module("landingApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/login.html",controller:"LoginController"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/dailyLogs",{templateUrl:"views/dailyLogs.html",controller:"DailyLogsController"}).when("/goals",{templateUrl:"views/goals.html",controller:"GoalsController"}).when("/myFoods",{templateUrl:"views/myFoods.html",controller:"MyFoodsController"}).when("/stats",{templateUrl:"views/stats.html",controller:"StatsController"}),b.html5Mode(!0)}]),app.controller("MainController",["$scope","$http","$location","UserService",function(a,b,c,d){a.userInfo=d.userInfo,a.logout=function(){console.log("logout button clicked"),b.get("/logout").then(function(a){console.log("logout response:",a.status),200==a.status&&(d.userInfo.data.isLoggedIn=!1,c.path("login"))})}}]),app.controller("RegisterController",["$scope","$http","$location","UserService",function(a,b,c,d){a.newUser={},a.registerUser=function(){b.post("/registerUser",a.newUser).then(function(a){200==a.status&&c.path("login")})}}]),app.controller("LoginController",["$scope","$http","$location","UserService",function(a,b,c,d){a.userLogin={},a.loginUser=function(){b.post("/loginUser",a.userLogin).then(function(a){200==a.status?(d.getUserInfo(),c.path("dailyLogs")):c.path("login")})}}]),app.controller("DailyLogsController",["$scope","$http","UserService",function(a,b,c){function d(){c.getUserInfo().then(function(a){e()})}function e(){a.total={calories:0,fat:0,carbs:0,protein:0,fiber:0,netCarbs:0};var b=c.userInfo.data.logs;a.date=a.date.toISOString(),a.date=a.date.substring(0,10);var d=[];a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[];for(var e=0;e<b.length;e++){var f=b[e].date;f=f.substring(0,10),f==a.date&&d.push(b[e])}for(var e=0;e<d.length;e++)a.total.calories+=d[e].food.calories,a.total.fat+=d[e].food.fat,a.total.carbs+=d[e].food.carbs,a.total.protein+=d[e].food.protein,a.total.fiber+=d[e].food.fiber,a.total.netCarbs+=d[e].food.carbs-d[e].food.fiber,"Breakfast"===d[e].meal?a.breakfasts.push(d[e]):"Lunch"===d[e].meal?a.lunches.push(d[e]):"Dinner"===d[e].meal?a.dinners.push(d[e]):"Snacks"===d[e].meal&&a.snacks.push(d[e])}a.userInfo=c.userInfo,a.date=new Date;var f=new Date;a.displayDate=a.date.toDateString(),a.meal="",a.addWindow=!1,a.searchFoods=[],a.loggedFoods=[],a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[],a.total={},a.addToMeal=function(b){a.meal=b,a.addWindow=!0},a.searchMyFoods=function(b){a.searchFoods=[];for(var d=c.userInfo.data.myFoods,e=0;e<d.length;e++)d[e].name.toLowerCase()===b.toLowerCase()&&a.searchFoods.push(d[e])},a.searchAPI=function(c){a.searchFoods=[];var d="https://api.nutritionix.com/v1_1/search/"+c+"?results=0:20&fields=item_name,nf_calories,nf_total_fat,nf_total_carbohydrate,nf_dietary_fiber,nf_protein&appId=ba0956f6&appKey=8f89eb62b769ec698f234199846da134";console.log(d),b.get(d).then(function(b){for(var c=b.data.hits,d=0;d<c.length;d++){var e={};e.name=c[d].fields.item_name,e.calories=Math.round(c[d].fields.nf_calories),e.fat=Math.round(c[d].fields.nf_total_fat),e.carbs=Math.round(c[d].fields.nf_total_carbohydrate),e.protein=Math.round(c[d].fields.nf_protein),e.fiber=Math.round(c[d].fields.nf_dietary_fiber),e.netCarbs=Math.round(c[d].fields.nf_total_carbohydrate-c[d].fields.nf_dietary_fiber),a.searchFoods.push(e)}console.log(a.searchFoods)})},a.addFood=function(a){for(var b=c.userInfo.data.myFoods,d=0;d<b.length;d++)b[d]._id===a&&logFood(b[d])},a.removeLog=function(a){b["delete"]("/userInfo/removeLog/"+a).then(function(a){d()})},a.logFood=function(b){console.log("food to add:",b);var d={username:c.userInfo.data.username,log:{date:a.date,food:b,meal:a.meal}};console.log("food to log:",d)},a.prevDay=function(){var b=f;console.log("clicked"),console.log("before:",b),b.setDate(b.getDate()-1),console.log("after:",b),f=b,a.date=b,a.displayDate=b.toDateString(),d()},a.nextDay=function(){var b=f;console.log("clicked"),console.log("before:",b),b.setDate(b.getDate()+1),console.log("after:",b),f=b,a.date=b,a.displayDate=b.toDateString(),d()},d()}]),app.controller("GoalsController",["$scope","$http","UserService",function(a,b,c){}]),app.controller("MyFoodsController",["$scope","$http","UserService",function(a,b,c){a.myFood={},a.userInfo=c.userInfo,a.allMyFoods=a.userInfo.data.myFoods,a.addMyFood=function(){a.error="";var d={username:a.userInfo.data.username,foodToAdd:a.myFood};b.put("/userInfo/addFood",d).then(function(b){"error"==b.data&&(a.error="Could not add that food. Please make sure all blanks are filled in."),c.getUserInfo(a.userInfo.data.username),a.displayMyFoods()})},a.displayMyFoods=function(){a.allMyFoods=a.userInfo.data.myFoods,c.getUserInfo()},a.displayMyFoods()}]),app.controller("StatsController",["$scope","$http","UserService",function(a,b,c){}]),app.factory("UserService",["$http",function(a){function b(){return console.log("getUserInfo called"),a.get("/userInfo").success(function(a){return console.log(a),c.data=a,c.data.isLoggedIn=!0,a})}var c={};return{getUserInfo:b,userInfo:c}}]);