var app=angular.module("landingApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/login.html",controller:"LoginController"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/dailyLogs",{templateUrl:"views/dailyLogs.html",controller:"DailyLogsController"}).when("/goals",{templateUrl:"views/goals.html",controller:"GoalsController"}).when("/myFoods",{templateUrl:"views/myFoods.html",controller:"MyFoodsController"}).when("/stats",{templateUrl:"views/stats.html",controller:"StatsController"}),b.html5Mode(!0)}]),app.controller("MainController",["$scope","$http","$location","UserService",function(a,b,c,d){a.userInfo=d.userInfo,a.logout=function(){console.log("logout button clicked"),b.get("/logout").then(function(a){console.log("logout response:",a.status),200==a.status&&(d.userInfo.data.isLoggedIn=!1,c.path("login"))})}}]),app.controller("RegisterController",["$scope","$http","$location","UserService",function(a,b,c,d){a.newUser={},a.registerUser=function(){b.post("/registerUser",a.newUser).then(function(a){200==a.status&&c.path("login")})}}]),app.controller("LoginController",["$scope","$http","$location","UserService",function(a,b,c,d){a.userLogin={},a.loginUser=function(){b.post("/loginUser",a.userLogin).then(function(a){200==a.status?(d.getUserInfo(),c.path("dailyLogs")):c.path("login")})}}]),app.controller("DailyLogsController",["$scope","$http","UserService",function(a,b,c){function d(){c.getUserInfo().then(function(a){e()})}function e(){a.total={calories:0,fat:0,carbs:0,protein:0,fiber:0,netCarbs:0};var b=c.userInfo.data.logs,d=f.toISOString();d=d.substring(0,10);var e=[];a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[];for(var g=0;g<b.length;g++){var h=b[g].date;h=h.substring(0,10),h==d&&e.push(b[g])}for(var g=0;g<e.length;g++)a.total.calories+=e[g].food.calories,a.total.fat+=e[g].food.fat,a.total.carbs+=e[g].food.carbs,a.total.protein+=e[g].food.protein,a.total.fiber+=e[g].food.fiber,a.total.netCarbs+=e[g].food.carbs-e[g].food.fiber,"Breakfast"===e[g].meal?a.breakfasts.push(e[g]):"Lunch"===e[g].meal?a.lunches.push(e[g]):"Dinner"===e[g].meal?a.dinners.push(e[g]):"Snacks"===e[g].meal&&a.snacks.push(e[g])}var f=new Date,g=new Date;a.userInfo=c.userInfo,a.displayDate=f.toDateString(),a.meal="",a.addWindow=!1,a.searchFoods=[],a.loggedFoods=[],a.breakfasts=[],a.lunches=[],a.dinners=[],a.snacks=[],a.total={},a.addToMeal=function(b){a.meal=b,a.addWindow=!0},a.searchMyFoods=function(b){a.searchFoods=[];for(var d=c.userInfo.data.myFoods,e=0;e<d.length;e++)d[e].name.toLowerCase()===b.toLowerCase()&&a.searchFoods.push(d[e])},a.searchAPI=function(c){a.searchFoods=[];var d="https://api.nutritionix.com/v1_1/search/"+c+"?results=0:20&fields=item_name,nf_calories,nf_total_fat,nf_total_carbohydrate,nf_dietary_fiber,nf_protein&appId=ba0956f6&appKey=8f89eb62b769ec698f234199846da134";b.get(d).then(function(b){for(var c=b.data.hits,d=0;d<c.length;d++){var e={};e.name=c[d].fields.item_name,e.calories=Math.round(c[d].fields.nf_calories),e.fat=Math.round(c[d].fields.nf_total_fat),e.carbs=Math.round(c[d].fields.nf_total_carbohydrate),e.protein=Math.round(c[d].fields.nf_protein),e.fiber=Math.round(c[d].fields.nf_dietary_fiber),e.netCarbs=Math.round(c[d].fields.nf_total_carbohydrate-c[d].fields.nf_dietary_fiber),a.searchFoods.push(e)}})},a.removeLog=function(a){b["delete"]("/userInfo/removeLog/"+a).then(function(a){d()})},a.logFood=function(e){var g={username:c.userInfo.data.username,log:{date:f,food:e,meal:a.meal}};console.log("food to log:",g),b.put("/userInfo/addLog",g).then(function(a){d()})},a.prevDay=function(){var b=g;b.setDate(b.getDate()-1),g=b,f=b,a.displayDate=b.toDateString(),d()},a.nextDay=function(){var b=g;b.setDate(b.getDate()+1),g=b,f=b,a.displayDate=b.toDateString(),d()},d()}]),app.controller("GoalsController",["$scope","$http","UserService",function(a,b,c){function d(){var a={username:c.userInfo.data.username,goals:{calories:2e3,fat:75,netCarbs:5,protein:20}};b.put("userInfo/updateGoals",a).then(function(){})}c.getUserInfo().then(function(){d()})}]),app.controller("MyFoodsController",["$scope","$http","UserService",function(a,b,c){a.myFood={},a.allMyFoods=c.userInfo.data.myFoods,a.addMyFood=function(){a.error="";var d={username:c.userInfo.data.username,foodToAdd:a.myFood};b.put("/userInfo/addFood",d).then(c.getUserInfo).then(function(b){a.allMyFoods=c.userInfo.data.myFoods,console.log("add food response:",b),"error"==b.data&&(a.error="Could not add that food. Please make sure all blanks are filled in.")})},a.removeMyFood=function(d){console.log("remove clicke",d),b["delete"]("/userInfo/removeMyFood/"+d).then(c.getUserInfo).then(function(b){a.allMyFoods=c.userInfo.data.myFoods})},c.getUserInfo}]),app.controller("StatsController",["$scope","$http","UserService",function(a,b,c){}]),app.factory("UserService",["$http",function(a){function b(){return a.get("/userInfo").success(function(a){return c.data=a,c.data.isLoggedIn=!0,a})}var c={};return{getUserInfo:b,userInfo:c}}]);